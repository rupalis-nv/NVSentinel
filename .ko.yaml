# Copyright (c) 2025, NVIDIA CORPORATION.  All rights reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# .ko.yaml in the root of the repository
defaultBaseImage: cgr.dev/chainguard/static:latest
platforms: [linux/amd64, linux/arm64]

ldflags:
  - "-s -w"
  - "-X main.version={{.Env.VERSION}} -X main.commit={{.Env.GIT_COMMIT}} -X main.date={{.Env.BUILD_DATE}}"

env: [CGO_ENABLED=0]

builds:

  - id: fault-quarantine-module
    dir: fault-quarantine-module
    main: .

  - id: fault-remediation-module
    dir: fault-remediation-module
    main: .

  - id: health-events-analyzer
    dir: health-events-analyzer
    main: .
    
  - id: csp-health-monitor
    dir: health-monitors/csp-health-monitor
    main: ./cmd/csp-health-monitor

  - id: maintenance-notifier
    dir: health-monitors/csp-health-monitor
    main: ./cmd/maintenance-notifier

  - id: labeler-module
    dir: labeler-module
    main: .

  - id: node-drainer-module
    dir: node-drainer-module
    main: .

  - id: janitor
    dir: janitor
    main: .

  - id: platform-connectors
    dir: platform-connectors
    main: .

labels:
  org.opencontainers.image.source: "https://github.com/nvidia/nvsentinel"
  org.opencontainers.image.licenses: "Apache-2.0"
  org.opencontainers.image.title: "NVSentinel"
  org.opencontainers.image.description: "Fault remediation service to help with rapidly node-level issues resolution in GPU-accelerated computing environments"
  org.opencontainers.image.version: "{{.Env.VERSION}}"
  org.opencontainers.image.revision: "{{.Env.GIT_COMMIT}}"
  org.opencontainers.image.created: "{{.Env.BUILD_DATE}}"
